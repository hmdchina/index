<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>正在连接服务器...</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}.a{background:#fff;border-radius:16px;padding:40px;max-width:500px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,.3)}.b{text-align:center;margin-bottom:30px}.b h1{font-size:28px;color:#333;margin-bottom:8px}.b p{color:#666;font-size:14px}.c{text-align:center;margin-bottom:30px}.d{width:50px;height:50px;border:4px solid #f3f3f3;border-top:4px solid #667eea;border-radius:50%;animation:e 1s linear infinite;margin:0 auto 20px}@keyframes e{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.f{font-size:16px;color:#333;margin-bottom:10px}.g{font-size:13px;color:#888}.h{margin-top:20px;border-top:1px solid #eee;padding-top:20px}.i{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f5f5f5;font-size:13px}.i:last-child{border-bottom:none}.i .j{color:#333;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-right:10px}.i .k{font-weight:500;min-width:80px;text-align:right}.i .k.l{color:#4caf50}.i .k.m{color:#f44336}.i .k.n{color:#ff9800}.i .k.o{color:#667eea;font-weight:700}.p{background:#fff3f3;border:1px solid #ffcdd2;border-radius:8px;padding:20px;margin-top:20px;display:none}.p h3{color:#c62828;font-size:16px;margin-bottom:10px}.p p{color:#666;font-size:13px;line-height:1.6}.q{margin-top:15px;padding:10px 30px;background:#667eea;color:#fff;border:none;border-radius:8px;font-size:14px;cursor:pointer;transition:background .3s}.q:hover{background:#5a6fd6}.r{display:none!important}.s{margin-top:20px;padding-top:20px;border-top:1px solid #eee}.s summary{cursor:pointer;color:#888;font-size:12px}.t{margin-top:15px}.t label{display:block;font-size:12px;color:#666;margin-bottom:5px}.t input,.t textarea{width:100%;padding:8px 12px;border:1px solid #ddd;border-radius:6px;font-size:13px;margin-bottom:15px}.t textarea{height:60px;resize:vertical}</style></head><body><div class="a"><div class="b"><h1>惠民达</h1><p>正在为您选择最佳服务器</p></div><div class="c" id="_0"><div class="d" id="_1"></div><div class="f" id="_2">正在解析服务器地址...</div><div class="g" id="_3">请稍候</div></div><div class="h" id="_4"></div><div class="p" id="_5"><h3>连接失败</h3><p id="_6">无法连接到服务器，请检查网络后重试。</p><button class="q" onclick="_A()">重新连接</button></div><details class="s"><summary>高级配置</summary><div class="t"><label>DNS TXT 域名</label><input type="text" id="_7" value="middleware-dev.cyou"><label>入口路径</label><input type="text" id="_8" value="/api/health/info"><label>AES 密钥 (Base64)</label><input type="text" id="_9" value="7qnax7EY-EGLJGWWpnoZ6A4-ax3eTqpGEjuYkc74qB0"><label>DoH 端点 (每行一个)</label><textarea id="_a">https://dns.alidns.com/resolve
https://doh.360.cn/resolve
https://1.12.12.12/dns-query
https://cloudflare-dns.com/dns-query</textarea><button class="q" onclick="_A()" style="width:100%">应用并重新连接</button></div></details></div><script>var _=function(a){return document.getElementById(a)},_b=function(a){var b=a.replace(/-/g,'+').replace(/_/g,'/');return b+='='.repeat((4-b.length%4)%4),Uint8Array.from(atob(b),function(c){return c.charCodeAt(0)})},_c=async function(a,b){try{var c=_b(b),d=_b(a);if(d.length<28)throw 0;var e=d.slice(0,12),f=d.slice(12),g=await crypto.subtle.importKey('raw',c,{name:'AES-GCM'},!1,['decrypt']);return new TextDecoder().decode(await crypto.subtle.decrypt({name:'AES-GCM',iv:e},g,f))}catch(h){return''}},_d=async function(a,b){var c=b.map(async function(d){try{var e=d+'?name='+encodeURIComponent(a)+'&type=TXT',f=await fetch(e,{headers:{accept:'application/dns-json'}});if(!f.ok)throw 0;var g=await f.json(),h=(g.Answer||[]).filter(function(i){return i.type===16}).map(function(i){return i.data.replace(/^"|"$/g,'')});if(!h.length)throw 0;return h.join(',')}catch(i){return null}});var j=c.map(async function(d){var e=await d;return e?e:new Promise(function(){})}),k=new Promise(function(d){setTimeout(function(){return d('')},8e3)});try{return await Promise.race([...j,k])}catch(l){return''}},_e=async function(a,b){var c=Array.from(a.matchAll(/ENC\(([^)]+)\)/g)),d=a;if(c.length&&b){var e=[];for(var f of c){var g=f[1].replace(/['"]/g,'').trim(),h=await _c(g,b);h&&e.push(h)}d=e.join(',')}return[...new Set(d.trim().split(/[\s,]+/g).map(function(i){return i.replace(/['"]/g,'').trim()}).filter(Boolean).map(function(i){return i.startsWith('http')?i:'https://'+i}).map(function(i){return i.replace(/\/+$/,'')}).filter(function(i){try{var j=new URL(i);return j.protocol==='http:'||j.protocol==='https:'}catch(k){return!1}}))]},_f=async function(a,b,c){var d=a+b,e=new AbortController,f=Date.now(),g=setTimeout(function(){return e.abort()},c);try{var h=d+(d.includes('?')?'&':'?')+'ts='+f,i=await fetch(h,{method:'GET',signal:e.signal,mode:'cors'});clearTimeout(g);var j=Date.now()-f;return{ok:i.ok,origin:a,durationMs:j}}catch(k){return clearTimeout(g),{ok:!1,origin:a,durationMs:1/0,error:k.message}}},_g=function(a,b){_('_2').textContent=a,_('_3').textContent=b||''},_h=function(a){_('_1').classList.add('r'),_('_5').style.display='block',_('_6').textContent=a},_i=function(){_('_1').classList.remove('r'),_('_5').style.display='none'},_j=function(a,b,c){var d=_('_4'),e=document.querySelector('[data-origin="'+CSS.escape(a)+'"]'),f='n',g='测速中...';b==='success'?(f='l',g=c+'ms'):b==='error'?(f='m',g='失败'):b==='best'&&(f='o',g=c+'ms ★');if(e)e.querySelector('.k').className='k '+f,e.querySelector('.k').textContent=g;else{var h=document.createElement('div');h.className='i',h.setAttribute('data-origin',a),h.innerHTML='<span class="j">'+a+'</span><span class="k '+f+'">'+g+'</span>',d.appendChild(h)}},_k=function(){_('_4').innerHTML=''},_A=async function(){_i(),_k();var a={dnsTxtDomain:_('_7').value.trim(),entryPath:_('_8').value.trim(),aesKeyBase64:_('_9').value.trim(),dohEndpoints:_('_a').value.split('\n').map(function(f){return f.trim()}).filter(Boolean),speedTestTimeoutMs:5e3};_g('正在解析服务器地址...','查询 '+a.dnsTxtDomain);var b=await _d(a.dnsTxtDomain,a.dohEndpoints);if(!b)return _h('DNS 解析失败，无法获取服务器地址。请检查网络连接或稍后重试。');_g('正在解析服务器列表...');var c=await _e(b,a.aesKeyBase64);if(!c.length)return _h('未找到有效的服务器地址。');_g('正在测试服务器速度...','共 '+c.length+' 个服务器'),c.forEach(function(f){return _j(f,'pending')});var d=await Promise.all(c.map(async function(f){var g=await _f(f,a.entryPath,a.speedTestTimeoutMs);return _j(f,g.ok?'success':'error',g.ok?g.durationMs:null),g})),e=d.filter(function(f){return f.ok}).sort(function(f,g){return f.durationMs-g.durationMs})[0];if(!e)return _h('所有服务器均无法连接。请检查网络连接或稍后重试。');_j(e.origin,'best',e.durationMs),_g('连接成功！','正在跳转到 '+e.origin),_('_1').style.borderTopColor='#4caf50',setTimeout(function(){window.location.href=e.origin},1e3)};document.addEventListener('DOMContentLoaded',function(){var a=new URLSearchParams(window.location.search);a.get('domain')&&(_('_7').value=a.get('domain')),a.get('entry')&&(_('_8').value=a.get('entry')),a.get('key')&&(_('_9').value=a.get('key')),_A()})</script></body></html>
